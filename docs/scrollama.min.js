!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.scrollama=e()}(this,function(){"use strict";function t(t){for(var e=t.length,n=[],o=0;o<e;o+=1)n.push(t[o]);return n}function e(t){return t instanceof Element?t:"string"==typeof t?document.querySelector(t):null}return function(t,e){function n(t){this.time=t.time,this.target=t.target,this.rootBounds=t.rootBounds,this.boundingClientRect=t.boundingClientRect,this.intersectionRect=t.intersectionRect||{top:0,bottom:0,left:0,right:0,width:0,height:0},this.isIntersecting=!!t.intersectionRect;var e=this.boundingClientRect,n=e.width*e.height,o=this.intersectionRect,r=o.width*o.height;this.intersectionRatio=n?r/n:this.isIntersecting?1:0}function o(t,e){var n=e||{};if("function"!=typeof t)throw new Error("callback must be a function");if(n.root&&1!=n.root.nodeType)throw new Error("root must be an Element");this._checkForIntersections=function(t,e){var n=null;return function(){n||(n=setTimeout(function(){t(),n=null},e))}}(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(n.rootMargin),this.thresholds=this._initThresholds(n.threshold),this.root=n.root||null,this.rootMargin=this._rootMarginValues.map(function(t){return t.value+t.unit}).join(" ")}function r(t,e,n,o){"function"==typeof t.addEventListener?t.addEventListener(e,n,o||!1):"function"==typeof t.attachEvent&&t.attachEvent("on"+e,n)}function i(t,e,n,o){"function"==typeof t.removeEventListener?t.removeEventListener(e,n,o||!1):"function"==typeof t.detatchEvent&&t.detatchEvent("on"+e,n)}function s(t){var e;try{e=t.getBoundingClientRect()}catch(t){}return e?(e.width&&e.height||(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}),e):{top:0,bottom:0,left:0,right:0,width:0,height:0}}function c(t,e){for(var n=e;n;){if(n==t)return!0;n=u(n)}return!1}function u(t){var e=t.parentNode;return e&&11==e.nodeType&&e.host?e.host:e}if("IntersectionObserver"in t&&"IntersectionObserverEntry"in t&&"intersectionRatio"in t.IntersectionObserverEntry.prototype)"isIntersecting"in t.IntersectionObserverEntry.prototype||Object.defineProperty(t.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});else{var a=[];o.prototype.THROTTLE_TIMEOUT=100,o.prototype.POLL_INTERVAL=null,o.prototype.USE_MUTATION_OBSERVER=!0,o.prototype.observe=function(t){if(!this._observationTargets.some(function(e){return e.element==t})){if(!t||1!=t.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:t,entry:null}),this._monitorIntersections(),this._checkForIntersections()}},o.prototype.unobserve=function(t){this._observationTargets=this._observationTargets.filter(function(e){return e.element!=t}),this._observationTargets.length||(this._unmonitorIntersections(),this._unregisterInstance())},o.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorIntersections(),this._unregisterInstance()},o.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t},o.prototype._initThresholds=function(t){var e=t||[0];return Array.isArray(e)||(e=[e]),e.sort().filter(function(t,e,n){if("number"!=typeof t||isNaN(t)||t<0||t>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return t!==n[e-1]})},o.prototype._parseRootMargin=function(t){var e=(t||"0px").split(/\s+/).map(function(t){var e=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(!e)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(e[1]),unit:e[2]}});return e[1]=e[1]||e[0],e[2]=e[2]||e[0],e[3]=e[3]||e[1],e},o.prototype._monitorIntersections=function(){this._monitoringIntersections||(this._monitoringIntersections=!0,this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(r(t,"resize",this._checkForIntersections,!0),r(e,"scroll",this._checkForIntersections,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in t&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))))},o.prototype._unmonitorIntersections=function(){this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,i(t,"resize",this._checkForIntersections,!0),i(e,"scroll",this._checkForIntersections,!0),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null))},o.prototype._checkForIntersections=function(){var e=this._rootIsInDom(),o=e?this._getRootRect():{top:0,bottom:0,left:0,right:0,width:0,height:0};this._observationTargets.forEach(function(r){var i=r.element,c=s(i),u=this._rootContainsTarget(i),a=r.entry,h=e&&u&&this._computeTargetAndRootIntersection(i,o),l=r.entry=new n({time:t.performance&&performance.now&&performance.now(),target:i,boundingClientRect:c,rootBounds:o,intersectionRect:h});a?e&&u?this._hasCrossedThreshold(a,l)&&this._queuedEntries.push(l):a&&a.isIntersecting&&this._queuedEntries.push(l):this._queuedEntries.push(l)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)},o.prototype._computeTargetAndRootIntersection=function(n,o){if("none"!=t.getComputedStyle(n).display){for(var r=s(n),i=u(n),c=!1;!c;){var a=null,h=1==i.nodeType?t.getComputedStyle(i):{};if("none"==h.display)return;if(i==this.root||i==e?(c=!0,a=o):i!=e.body&&i!=e.documentElement&&"visible"!=h.overflow&&(a=s(i)),a&&!(r=function(t,e){var n=Math.max(t.top,e.top),o=Math.min(t.bottom,e.bottom),r=Math.max(t.left,e.left),i=Math.min(t.right,e.right),s=i-r,c=o-n;return s>=0&&c>=0&&{top:n,bottom:o,left:r,right:i,width:s,height:c}}(a,r)))break;i=u(i)}return r}},o.prototype._getRootRect=function(){var t;if(this.root)t=s(this.root);else{var n=e.documentElement,o=e.body;t={top:0,left:0,right:n.clientWidth||o.clientWidth,width:n.clientWidth||o.clientWidth,bottom:n.clientHeight||o.clientHeight,height:n.clientHeight||o.clientHeight}}return this._expandRectByRootMargin(t)},o.prototype._expandRectByRootMargin=function(t){var e=this._rootMarginValues.map(function(e,n){return"px"==e.unit?e.value:e.value*(n%2?t.width:t.height)/100}),n={top:t.top-e[0],right:t.right+e[1],bottom:t.bottom+e[2],left:t.left-e[3]};return n.width=n.right-n.left,n.height=n.bottom-n.top,n},o.prototype._hasCrossedThreshold=function(t,e){var n=t&&t.isIntersecting?t.intersectionRatio||0:-1,o=e.isIntersecting?e.intersectionRatio||0:-1;if(n!==o)for(var r=0;r<this.thresholds.length;r++){var i=this.thresholds[r];if(i==n||i==o||i<n!=i<o)return!0}},o.prototype._rootIsInDom=function(){return!this.root||c(e,this.root)},o.prototype._rootContainsTarget=function(t){return c(this.root||e,t)},o.prototype._registerInstance=function(){a.indexOf(this)<0&&a.push(this)},o.prototype._unregisterInstance=function(){var t=a.indexOf(this);-1!=t&&a.splice(t,1)},t.IntersectionObserver=o,t.IntersectionObserverEntry=n}}(window,document),function(){function n(t){var e=0;if(t.offsetParent)do{e+=t.offsetTop,t=t.offsetParent}while(t);return e<0?0:e}function o(t){return+t.getAttribute("data-scrollama-index")}function r(){window.pageYOffset>W?D="down":window.pageYOffset<W&&(D="up"),W=window.pageYOffset}function i(){B=window.innerHeight,k=function(){var t=document.body,e=document.documentElement;return Math.max(t.scrollHeight,t.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight)}(),F=T?T.getBoundingClientRect():null,C=A*B,L=M?M.map(function(t){return t.offsetHeight}):[],P=M?M.map(n):[],S&&H&&_(),q&&(document.querySelector("#scrollama__debug--offset-"+w).style.top=C+"px")}function s(t){t&&!S?(H&&_(),S=!0):t||(R.top&&R.top.disconnect(),R.bottom&&R.bottom.disconnect(),R.stepAbove&&R.stepAbove.forEach(function(t){return t.disconnect()}),R.stepBelow&&R.stepBelow.forEach(function(t){return t.disconnect()}),R.stepProgress&&R.stepProgress.forEach(function(t){return t.disconnect()}),R.viewportAbove&&R.viewportAbove.forEach(function(t){return t.disconnect()}),R.viewportBelow&&R.viewportBelow.forEach(function(t){return t.disconnect()}),S=!1)}function c(t,e){if("above"===e)for(var n=0;n<t;n++){var o=j[n];"enter"===o.state&&a(M[n]),"up"===o.direction&&(u(M[n],"down"),a(M[n]))}else if("below"===e)for(var r=j.length-1;r>t;r--){var i=j[r];"enter"===i.state&&a(M[r]),"down"===i.direction&&(u(M[r],"up"),a(M[r]))}}function u(t,e){void 0===e&&(e=!0);var n=o(t),r={element:t,index:n,direction:D};j[n].direction=D,j[n].state="enter",U&&e&&"down"===D&&c(n,"above"),U&&e&&"up"===D&&c(n,"below"),x.stepEnter&&"function"==typeof x.stepEnter&&x.stepEnter(r,j),N&&("down"===D?h(t,0):h(t,1))}function a(t){var e=o(t),n={element:t,index:e,direction:D};j[e].direction=D,j[e].state="exit",N&&("down"===D?h(t,1):h(t,0)),x.stepExit&&"function"==typeof x.stepExit&&x.stepExit(n,j)}function h(t,e){var n={element:t,index:o(t),progress:e};x.stepProgress&&"function"==typeof x.stepProgress&&x.stepProgress(n)}function l(){var t={direction:D};z.direction=D,z.state="enter",x.containerEnter&&"function"==typeof x.containerEnter&&x.containerEnter(t)}function f(){var t={direction:D};z.direction=D,z.state="exit",x.containerExit&&"function"==typeof x.containerExit&&x.containerExit(t)}function p(t){r(),t.forEach(function(t){var e=t.isIntersecting,n=t.boundingClientRect,r=t.target,i=n.bottom,s=n.height,c=i-C,h=o(r),l=j[h];c>=-I&&(e&&"down"===D&&"enter"!==l.state?u(r,D):e||"up"!==D||"enter"!==l.state?!e&&c>=s&&"down"===D&&"enter"===l.state&&a(r):a(r))})}function d(t){r(),t.forEach(function(t){var e=t.isIntersecting,n=t.boundingClientRect,r=t.target,i=n.bottom,s=n.height,c=i-C,h=o(r),l=j[h];c>=-I&&c<s&&e&&"up"===D&&"enter"!==l.state?u(r,D):c<=I&&!e&&"down"===D&&"enter"===l.state&&a(r)})}function g(t){r(),t.forEach(function(t){var e=t.isIntersecting,n=t.target,r=o(n),i=j[r];e&&"down"===D&&"enter"!==i.state&&"down"!==i.direction&&(u(n,"down"),a(n))})}function v(t){r(),t.forEach(function(t){var e=t.isIntersecting,n=t.target,r=o(n),i=j[r];e&&"up"===D&&"enter"!==i.state&&"up"!==i.direction&&(u(n,"up"),a(n))})}function m(t){r(),t.forEach(function(t){var e=t.isIntersecting,n=t.intersectionRatio,o=t.boundingClientRect,r=t.target,i=o.bottom;e&&i-C>=-I&&h(r,+n.toFixed(3))})}function b(t){r();var e=t[0],n=e.isIntersecting,o=e.boundingClientRect;o.top,o.bottom>-I&&(n?l():"enter"===z.state&&f())}function y(t){r();var e=t[0],n=e.isIntersecting;e.boundingClientRect.top<I&&(n?l():"enter"===z.state&&f())}function E(){R.stepProgress&&R.stepProgress.forEach(function(t){return t.disconnect()}),R.stepProgress=M.map(function(t,e){var n={root:null,rootMargin:L[e]-C+"px 0px "+(-B+C)+"px 0px",threshold:function(t){for(var e=Math.ceil(t/V),n=[],o=1/e,r=0;r<e;r++)n.push(r*o);return n}(L[e])},o=new IntersectionObserver(m,n);return o.observe(t),o})}function _(){R.viewportAbove&&R.viewportAbove.forEach(function(t){return t.disconnect()}),R.viewportAbove=M.map(function(t,e){var n={root:null,rootMargin:P[e]+"px 0px "+-(B-C+L[e])+"px 0px",threshold:0},o=new IntersectionObserver(g,n);return o.observe(t),o}),R.viewportBelow&&R.viewportBelow.forEach(function(t){return t.disconnect()}),R.viewportBelow=M.map(function(t,e){var n={root:null,rootMargin:-(C+L[e])+"px 0px "+(k-P[e]-L[e]-C)+"px 0px",threshold:0},o=new IntersectionObserver(v,n);return o.observe(t),o}),R.stepAbove&&R.stepAbove.forEach(function(t){return t.disconnect()}),R.stepAbove=M.map(function(t,e){var n={root:null,rootMargin:L[e]+"px 0px "+(-B+C)+"px 0px",threshold:0},o=new IntersectionObserver(p,n);return o.observe(t),o}),R.stepBelow&&R.stepBelow.forEach(function(t){return t.disconnect()}),R.stepBelow=M.map(function(t,e){var n={root:null,rootMargin:-C+"px 0px "+(k-B+L[e]+C)+"px 0px",threshold:0},o=new IntersectionObserver(d,n);return o.observe(t),o}),N&&E(),O&&T&&(function(){R.top&&R.top.unobserve(O);var t={root:null,rootMargin:B+"px 0px -"+B+"px 0px",threshold:0};R.top=new IntersectionObserver(b,t),R.top.observe(O)}(),function(){R.bottom&&R.bottom.unobserve(O);var t={root:null,rootMargin:"-"+F.height+"px 0px "+F.height+"px 0px",threshold:0};R.bottom=new IntersectionObserver(y,t),R.bottom.observe(O)}())}var w=Math.floor(1e5*Math.random()),I=1,x={},R={},O=null,T=null,M=null,A=0,C=0,B=0,k=0,L=null,P=null,F=null,H=!1,S=!1,q=!1,N=!1,V=0,U=!1,j=null,z=null,W=-1,D=null,Y={};return Y.setup=function(n){var o=n.container,r=n.graphic,c=n.step,u=n.offset;void 0===u&&(u=.5);var a=n.progress;void 0===a&&(a=!1);var h=n.threshold;void 0===h&&(h=4);var l=n.debug;void 0===l&&(l=!1);var f=n.order;return void 0===f&&(f=!0),M=function(e,n){return void 0===n&&(n=document),"string"==typeof e?t(n.querySelectorAll(e)):e instanceof NodeList?t(e):e instanceof Array?e:[]}(c),O=o?e(o):null,T=r?e(r):null,M.length?(q=l,N=a,U=f,A=Math.min(Math.max(0,u),1),V=Math.max(1,+h),H=!0,function(){if(q){var t=document.createElement("div");t.setAttribute("id","scrollama__debug--offset-"+w),t.setAttribute("class","scrollama__debug--offset"),t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="1px",t.style.borderBottom="1px dashed red";var e=document.createElement("p"),n=M[0].getAttribute("class");e.innerText='".'+n+'" trigger: '+A,e.style.fontSize="12px",e.style.fontFamily="monospace",e.style.color="red",e.style.margin="0",e.style.padding="6px",t.appendChild(e),document.body.appendChild(t)}}(),M.forEach(function(t,e){return t.setAttribute("data-scrollama-index",e)}),j=M.map(function(){return{direction:null,state:null}}),z={direction:null,state:null},i(),s(!0),Y):(console.error("scrollama error: no step elements"),Y)},Y.resize=function(){return i(),Y},Y.enable=function(){return s(!0),Y},Y.disable=function(){return s(!1),Y},Y.destroy=function(){s(!1),Object.keys(x).forEach(function(t){return x[t]=null}),Object.keys(R).forEach(function(t){return R[t]=null})},Y.onStepEnter=function(t){return x.stepEnter=t,Y},Y.onStepExit=function(t){return x.stepExit=t,Y},Y.onStepProgress=function(t){return x.stepProgress=t,Y},Y.onContainerEnter=function(t){return x.containerEnter=t,Y},Y.onContainerExit=function(t){return x.containerExit=t,Y},Y}});
