!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.scrollama=e()}(this,function(){"use strict";function t(t){for(var e=t.length,n=[],o=0;o<e;o+=1)n.push(t[o]);return n}function e(t){return t instanceof Element?t:"string"==typeof t?document.querySelector(t):null}function n(t){return"scrollama__debug-step--"+t.id+"-"+t.i}function o(t){return"scrollama__debug-offset--"+t.id}function r(t){var e=t.id,r=t.offsetVal,i=t.stepEl,s=i[0].getAttribute("class");i.forEach(function(t,o){return function(t){var e=n({id:t.id,i:t.i}),o=document.createElement("div");o.setAttribute("id",e+"_above"),o.setAttribute("class","scrollama__debug-step"),o.style.position="fixed",o.style.left="0",o.style.width="100%",o.style.backgroundImage="repeating-linear-gradient(45deg, green 0, green 2px, white 0, white 40px)",o.style.border="2px solid green",o.style.opacity="0.33",o.style.zIndex="9999",o.style.display="none",document.body.appendChild(o);var r=document.createElement("div");r.setAttribute("id",e+"_below"),r.setAttribute("class","scrollama__debug-step"),r.style.position="fixed",r.style.left="0",r.style.width="100%",r.style.backgroundImage="repeating-linear-gradient(135deg, orange 0, orange 2px, white 0, white 40px)",r.style.border="2px solid orange",r.style.opacity="0.33",r.style.zIndex="9999",r.style.display="none",document.body.appendChild(r)}({id:e,i:o})}),function(t){var e=t.id,n=t.offsetVal,r=t.stepClass,i=document.createElement("div");i.setAttribute("id",o({id:e})),i.setAttribute("class","scrollama__debug-offset"),i.style.position="fixed",i.style.left="0",i.style.width="100%",i.style.height="0px",i.style.borderTop="2px dashed black",i.style.zIndex="9999";var s=document.createElement("p");s.innerText='".'+r+'" trigger: '+n,s.style.fontSize="12px",s.style.fontFamily="monospace",s.style.color="black",s.style.margin="0",s.style.padding="6px",i.appendChild(s),document.body.appendChild(i)}({id:e,offsetVal:r,stepClass:s})}function i(t){var e=t.id,r=t.stepOffsetHeight,i=t.offsetMargin;t.offsetVal;r.forEach(function(t,o){return function(t){var e=t.id,o=t.h,r=t.i,i=t.offsetMargin,s=n({id:e,i:r}),c=document.querySelector("#"+s+"_above");c.style.height=o+"px",c.style.top=i-o+"px";var a=document.querySelector("#"+s+"_below");a.style.height=o+"px",a.style.top=i+"px"}({id:e,h:t,i:o,offsetMargin:i})}),function(t){var e=t.id,n=t.offsetMargin,r=(t.offsetVal,o({id:e}));document.querySelector("#"+r).style.top=n+"px"}({id:e,offsetMargin:i})}function s(t){var e=t.id,o=t.index,r=t.state,i=n({id:e,i:o}),s=document.querySelector("#"+i+"_above"),c=document.querySelector("#"+i+"_below"),a="enter"===r?"block":"none";s&&(s.style.display=a),c&&(c.style.display=a)}return function(t,e){function n(t){this.time=t.time,this.target=t.target,this.rootBounds=t.rootBounds,this.boundingClientRect=t.boundingClientRect,this.intersectionRect=t.intersectionRect||{top:0,bottom:0,left:0,right:0,width:0,height:0},this.isIntersecting=!!t.intersectionRect;var e=this.boundingClientRect,n=e.width*e.height,o=this.intersectionRect,r=o.width*o.height;this.intersectionRatio=n?r/n:this.isIntersecting?1:0}function o(t,e){var n=e||{};if("function"!=typeof t)throw new Error("callback must be a function");if(n.root&&1!=n.root.nodeType)throw new Error("root must be an Element");this._checkForIntersections=function(t,e){var n=null;return function(){n||(n=setTimeout(function(){t(),n=null},e))}}(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(n.rootMargin),this.thresholds=this._initThresholds(n.threshold),this.root=n.root||null,this.rootMargin=this._rootMarginValues.map(function(t){return t.value+t.unit}).join(" ")}function r(t,e,n,o){"function"==typeof t.addEventListener?t.addEventListener(e,n,o||!1):"function"==typeof t.attachEvent&&t.attachEvent("on"+e,n)}function i(t,e,n,o){"function"==typeof t.removeEventListener?t.removeEventListener(e,n,o||!1):"function"==typeof t.detatchEvent&&t.detatchEvent("on"+e,n)}function s(t){var e;try{e=t.getBoundingClientRect()}catch(t){}return e?(e.width&&e.height||(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}),e):{top:0,bottom:0,left:0,right:0,width:0,height:0}}function c(t,e){for(var n=e;n;){if(n==t)return!0;n=a(n)}return!1}function a(t){var e=t.parentNode;return e&&11==e.nodeType&&e.host?e.host:e}if("IntersectionObserver"in t&&"IntersectionObserverEntry"in t&&"intersectionRatio"in t.IntersectionObserverEntry.prototype)"isIntersecting"in t.IntersectionObserverEntry.prototype||Object.defineProperty(t.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});else{var u=[];o.prototype.THROTTLE_TIMEOUT=100,o.prototype.POLL_INTERVAL=null,o.prototype.USE_MUTATION_OBSERVER=!0,o.prototype.observe=function(t){if(!this._observationTargets.some(function(e){return e.element==t})){if(!t||1!=t.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:t,entry:null}),this._monitorIntersections(),this._checkForIntersections()}},o.prototype.unobserve=function(t){this._observationTargets=this._observationTargets.filter(function(e){return e.element!=t}),this._observationTargets.length||(this._unmonitorIntersections(),this._unregisterInstance())},o.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorIntersections(),this._unregisterInstance()},o.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t},o.prototype._initThresholds=function(t){var e=t||[0];return Array.isArray(e)||(e=[e]),e.sort().filter(function(t,e,n){if("number"!=typeof t||isNaN(t)||t<0||t>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return t!==n[e-1]})},o.prototype._parseRootMargin=function(t){var e=(t||"0px").split(/\s+/).map(function(t){var e=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(!e)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(e[1]),unit:e[2]}});return e[1]=e[1]||e[0],e[2]=e[2]||e[0],e[3]=e[3]||e[1],e},o.prototype._monitorIntersections=function(){this._monitoringIntersections||(this._monitoringIntersections=!0,this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(r(t,"resize",this._checkForIntersections,!0),r(e,"scroll",this._checkForIntersections,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in t&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))))},o.prototype._unmonitorIntersections=function(){this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,i(t,"resize",this._checkForIntersections,!0),i(e,"scroll",this._checkForIntersections,!0),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null))},o.prototype._checkForIntersections=function(){var e=this._rootIsInDom(),o=e?this._getRootRect():{top:0,bottom:0,left:0,right:0,width:0,height:0};this._observationTargets.forEach(function(r){var i=r.element,c=s(i),a=this._rootContainsTarget(i),u=r.entry,l=e&&a&&this._computeTargetAndRootIntersection(i,o),h=r.entry=new n({time:t.performance&&performance.now&&performance.now(),target:i,boundingClientRect:c,rootBounds:o,intersectionRect:l});u?e&&a?this._hasCrossedThreshold(u,h)&&this._queuedEntries.push(h):u&&u.isIntersecting&&this._queuedEntries.push(h):this._queuedEntries.push(h)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)},o.prototype._computeTargetAndRootIntersection=function(n,o){if("none"!=t.getComputedStyle(n).display){for(var r=s(n),i=a(n),c=!1;!c;){var u=null,l=1==i.nodeType?t.getComputedStyle(i):{};if("none"==l.display)return;if(i==this.root||i==e?(c=!0,u=o):i!=e.body&&i!=e.documentElement&&"visible"!=l.overflow&&(u=s(i)),u&&!(r=function(t,e){var n=Math.max(t.top,e.top),o=Math.min(t.bottom,e.bottom),r=Math.max(t.left,e.left),i=Math.min(t.right,e.right),s=i-r,c=o-n;return s>=0&&c>=0&&{top:n,bottom:o,left:r,right:i,width:s,height:c}}(u,r)))break;i=a(i)}return r}},o.prototype._getRootRect=function(){var t;if(this.root)t=s(this.root);else{var n=e.documentElement,o=e.body;t={top:0,left:0,right:n.clientWidth||o.clientWidth,width:n.clientWidth||o.clientWidth,bottom:n.clientHeight||o.clientHeight,height:n.clientHeight||o.clientHeight}}return this._expandRectByRootMargin(t)},o.prototype._expandRectByRootMargin=function(t){var e=this._rootMarginValues.map(function(e,n){return"px"==e.unit?e.value:e.value*(n%2?t.width:t.height)/100}),n={top:t.top-e[0],right:t.right+e[1],bottom:t.bottom+e[2],left:t.left-e[3]};return n.width=n.right-n.left,n.height=n.bottom-n.top,n},o.prototype._hasCrossedThreshold=function(t,e){var n=t&&t.isIntersecting?t.intersectionRatio||0:-1,o=e.isIntersecting?e.intersectionRatio||0:-1;if(n!==o)for(var r=0;r<this.thresholds.length;r++){var i=this.thresholds[r];if(i==n||i==o||i<n!=i<o)return!0}},o.prototype._rootIsInDom=function(){return!this.root||c(e,this.root)},o.prototype._rootContainsTarget=function(t){return c(this.root||e,t)},o.prototype._registerInstance=function(){u.indexOf(this)<0&&u.push(this)},o.prototype._unregisterInstance=function(){var t=u.indexOf(this);-1!=t&&u.splice(t,1)},t.IntersectionObserver=o,t.IntersectionObserverEntry=n}}(window,document),function(){function n(t){var e=0;if(t.offsetParent)do{e+=t.offsetTop,t=t.offsetParent}while(t);return e<0?0:e}function o(t){return+t.getAttribute("data-scrollama-index")}function c(){window.pageYOffset>G?J="down":window.pageYOffset<G&&(J="up"),G=window.pageYOffset}function a(){S=window.innerHeight,P=function(){var t=document.body,e=document.documentElement;return Math.max(t.scrollHeight,t.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight)}(),V=A?A.getBoundingClientRect():null,L=B*S,q=C?C.map(function(t){return t.offsetHeight}):[],H=C?C.map(n):[],N&&F&&I(),j&&i({id:k,stepOffsetHeight:q,offsetMargin:L,offsetVal:B})}function u(t){t&&!N?(F&&I(),N=!0):t||(O.top&&O.top.disconnect(),O.bottom&&O.bottom.disconnect(),O.stepAbove&&O.stepAbove.forEach(function(t){return t.disconnect()}),O.stepBelow&&O.stepBelow.forEach(function(t){return t.disconnect()}),O.stepProgress&&O.stepProgress.forEach(function(t){return t.disconnect()}),O.viewportAbove&&O.viewportAbove.forEach(function(t){return t.disconnect()}),O.viewportBelow&&O.viewportBelow.forEach(function(t){return t.disconnect()}),N=!1)}function l(t,e){if("above"===e)for(var n=0;n<t;n++){var o=Y[n];"enter"===o.state&&f(C[n]),"up"===o.direction&&(h(C[n],"down"),f(C[n]))}else if("below"===e)for(var r=Y.length-1;r>t;r--){var i=Y[r];"enter"===i.state&&f(C[r]),"down"===i.direction&&(h(C[r],"up"),f(C[r]))}}function h(t,e){void 0===e&&(e=!0);var n=o(t),r={element:t,index:n,direction:J};Y[n].direction=J,Y[n].state="enter",D&&e&&"down"===J&&l(n,"above"),D&&e&&"up"===J&&l(n,"below"),T.stepEnter&&"function"==typeof T.stepEnter&&!K[n]&&(T.stepEnter(r,Y),j&&s({id:k,index:n,state:"enter"}),W&&(K[n]=!0)),z&&("down"===J?p(t,0):p(t,1))}function f(t){var e=o(t),n={element:t,index:e,direction:J};Y[e].direction=J,Y[e].state="exit",z&&("down"===J?p(t,1):p(t,0)),T.stepExit&&"function"==typeof T.stepExit&&(T.stepExit(n,Y),j&&s({id:k,index:e,state:"exit"}))}function p(t,e){var n={element:t,index:o(t),progress:e};T.stepProgress&&"function"==typeof T.stepProgress&&T.stepProgress(n)}function d(){var t={direction:J};$.direction=J,$.state="enter",T.containerEnter&&"function"==typeof T.containerEnter&&T.containerEnter(t)}function g(){var t={direction:J};$.direction=J,$.state="exit",T.containerExit&&"function"==typeof T.containerExit&&T.containerExit(t)}function v(t){c(),t.forEach(function(t){var e=t.isIntersecting,n=t.boundingClientRect,r=t.target,i=n.bottom,s=n.height,c=i-L,a=o(r),u=Y[a];c>=-R&&(e&&"down"===J&&"enter"!==u.state?h(r,J):e||"up"!==J||"enter"!==u.state?!e&&c>=s&&"down"===J&&"enter"===u.state&&f(r):f(r))})}function b(t){c(),t.forEach(function(t){var e=t.isIntersecting,n=t.boundingClientRect,r=t.target,i=n.bottom,s=n.height,c=i-L,a=o(r),u=Y[a];c>=-R&&c<s&&e&&"up"===J&&"enter"!==u.state?h(r,J):c<=R&&!e&&"down"===J&&"enter"===u.state&&f(r)})}function m(t){c(),t.forEach(function(t){var e=t.isIntersecting,n=t.target,r=o(n),i=Y[r];e&&"down"===J&&"enter"!==i.state&&"down"!==i.direction&&(h(n,"down"),f(n))})}function y(t){c(),t.forEach(function(t){var e=t.isIntersecting,n=t.target,r=o(n),i=Y[r];e&&"up"===J&&"enter"!==i.state&&"up"!==i.direction&&(h(n,"up"),f(n))})}function _(t){c(),t.forEach(function(t){var e=t.isIntersecting,n=t.intersectionRatio,o=t.boundingClientRect,r=t.target,i=o.bottom;e&&i-L>=-R&&p(r,+n.toFixed(3))})}function E(t){c();var e=t[0],n=e.isIntersecting,o=e.boundingClientRect;o.top,o.bottom>-R&&(n?d():"enter"===$.state&&g())}function w(t){c();var e=t[0],n=e.isIntersecting;e.boundingClientRect.top<R&&(n?d():"enter"===$.state&&g())}function x(){O.stepProgress&&O.stepProgress.forEach(function(t){return t.disconnect()}),O.stepProgress=C.map(function(t,e){var n={root:null,rootMargin:q[e]-L+"px 0px "+(-S+L)+"px 0px",threshold:function(t){for(var e=Math.ceil(t/U),n=[],o=1/e,r=0;r<e;r++)n.push(r*o);return n}(q[e])},o=new IntersectionObserver(_,n);return o.observe(t),o})}function I(){O.viewportAbove&&O.viewportAbove.forEach(function(t){return t.disconnect()}),O.viewportAbove=C.map(function(t,e){var n={root:null,rootMargin:H[e]+"px 0px "+-(S-L+q[e])+"px 0px",threshold:0},o=new IntersectionObserver(m,n);return o.observe(t),o}),O.viewportBelow&&O.viewportBelow.forEach(function(t){return t.disconnect()}),O.viewportBelow=C.map(function(t,e){var n={root:null,rootMargin:-(L+q[e])+"px 0px "+(P-H[e]-q[e]-L)+"px 0px",threshold:0},o=new IntersectionObserver(y,n);return o.observe(t),o}),O.stepAbove&&O.stepAbove.forEach(function(t){return t.disconnect()}),O.stepAbove=C.map(function(t,e){var n={root:null,rootMargin:q[e]+"px 0px "+(-S+L)+"px 0px",threshold:0},o=new IntersectionObserver(v,n);return o.observe(t),o}),O.stepBelow&&O.stepBelow.forEach(function(t){return t.disconnect()}),O.stepBelow=C.map(function(t,e){var n={root:null,rootMargin:-L+"px 0px "+(P-S+q[e]+L)+"px 0px",threshold:0},o=new IntersectionObserver(b,n);return o.observe(t),o}),z&&x(),M&&A&&(function(){O.top&&O.top.unobserve(M);var t={root:null,rootMargin:S+"px 0px -"+S+"px 0px",threshold:0};O.top=new IntersectionObserver(E,t),O.top.observe(M)}(),function(){O.bottom&&O.bottom.unobserve(M);var t={root:null,rootMargin:"-"+V.height+"px 0px "+V.height+"px 0px",threshold:0};O.bottom=new IntersectionObserver(w,t),O.bottom.observe(M)}())}var R=1,T={},O={},M=null,A=null,C=null,k=null,B=0,L=0,S=0,P=0,q=null,H=null,V=null,F=!1,N=!1,j=!1,z=!1,U=0,D=!1,W=!1,Y=null,$=null,G=-1,J=null,K=[],Q={};return Q.setup=function(n){var o=n.container,i=n.graphic,s=n.step,c=n.offset;void 0===c&&(c=.5);var l=n.progress;void 0===l&&(l=!1);var h=n.threshold;void 0===h&&(h=4);var f=n.debug;void 0===f&&(f=!1);var p=n.order;void 0===p&&(p=!0);var d=n.once;return void 0===d&&(d=!1),k=function(){var t="abcdefghijklmnopqrstuv",e=t.length,n=(new Date).getTime();return""+[0,0,0].map(function(n){return t[Math.floor(Math.random()*e)]}).join("")+n}(),C=function(e,n){return void 0===n&&(n=document),"string"==typeof e?t(n.querySelectorAll(e)):e instanceof NodeList?t(e):e instanceof Array?e:[]}(s),M=o?e(o):null,A=i?e(i):null,C.length?(j=f,z=l,D=p,W=d,Q.offsetTrigger(c),U=Math.max(1,+h),F=!0,j&&r({id:k,stepEl:C,offsetVal:B}),C.forEach(function(t,e){return t.setAttribute("data-scrollama-index",e)}),Y=C.map(function(){return{direction:null,state:null}}),$={direction:null,state:null},a(),u(!0),Q):(console.error("scrollama error: no step elements"),Q)},Q.resize=function(){return a(),Q},Q.enable=function(){return u(!0),Q},Q.disable=function(){return u(!1),Q},Q.destroy=function(){u(!1),Object.keys(T).forEach(function(t){return T[t]=null}),Object.keys(O).forEach(function(t){return O[t]=null})},Q.offsetTrigger=function(t){return t&&(isNaN(t),!0)?(B=Math.min(Math.max(0,t),1),Q):B},Q.onStepEnter=function(t){return T.stepEnter=t,Q},Q.onStepExit=function(t){return T.stepExit=t,Q},Q.onStepProgress=function(t){return T.stepProgress=t,Q},Q.onContainerEnter=function(t){return T.containerEnter=t,Q},Q.onContainerExit=function(t){return T.containerExit=t,Q},Q}});
